apiVersion: v1
kind: Secret
metadata:
  name: rhacs-alertmanager-configuration
  namespace: {{ include "observability.namespace" . }}
stringData:
  alertmanager.yaml: |
    global:
      resolve_timeout: 5m
    route:
      receiver: slack
      repeat_interval: 12h
      routes:
      - receiver: managed-rhacs-pagerduty
        match:
          observability: managed-rhacs
          severity: critical
          rhacs_environment: prod
      - receiver: managed-rhacs-deadmanssnitch
        repeat_interval: 5m
        match:
          alertname: DeadMansSwitch
          observability: managed-rhacs
    receivers:
    - name: managed-rhacs-pagerduty
      pagerduty_configs:
      - service_key: {{ .Values.pagerduty.key | quote }}
    - name: managed-rhacs-deadmanssnitch
      webhook_configs:
      - url: {{ .Values.deadMansSwitch.url | quote }}
    - name: slack
      slack_configs:
      - send_resolved: true
        api_url: {{ .Values.slack.apiURL | quote }}
        title_link: '{{ "{{" }} template "slack.default.titlelink" . {{ "}}" }}'
{{ .Files.Get "slack-receiver-config.yaml" | indent 8 }}
type: Opaque
